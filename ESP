--skidded script and AI
local players = game:GetService("Players")
repeat task.wait() until players.LocalPlayer
local localplayer = players.LocalPlayer

local ph={}
local sh={}
local ws=workspace
local boxes={}
local lastupdate=0

local function getbbox(char)
    local min_x,min_y=math.huge,math.huge
    local max_x,max_y=-math.huge,-math.huge
    local found=false
    for _,part in pairs(char:GetChildren()) do
        if part:IsA("BasePart") then
            local pos=part.Position
            local sz=part.Size/2
            for _,offset in pairs({Vector3.new(-sz.X,-sz.Y,-sz.Z),Vector3.new(sz.X,sz.Y,sz.Z)}) do
                local screen,vis=WorldToScreen(pos+offset)
                if vis then
                    found=true
                    min_x=math.min(min_x,screen.x)
                    min_y=math.min(min_y,screen.y)
                    max_x=math.max(max_x,screen.x)
                    max_y=math.max(max_y,screen.y)
                end
            end
        end
    end
    return found,min_x,min_y,max_x-min_x,max_y-min_y
end

local function Sheriff(player)
    if player and player.Character then
        local backpack=player:FindFirstChildOfClass("Backpack")
        if backpack then
            for _,item in ipairs(backpack:GetChildren()) do
                if item:IsA("Tool") and item.Name:lower():find("gun") then return true end
            end
        end
        for _,item in ipairs(player.Character:GetChildren()) do
            if item:IsA("Tool") and item.Name:lower():find("gun") then return true end
        end
    end
    return false
end

local function add_esp(plr)
    local box={
        outline1=Drawing.new("Square"),
        outline2=Drawing.new("Square"),
        main=Drawing.new("Square"),
        name=Drawing.new("Text")
    }
    box.outline1.Thickness=1 box.outline1.Filled=false box.outline1.Color=Color3.fromRGB(0,0,0)
    box.outline2.Thickness=1 box.outline2.Filled=false box.outline2.Color=Color3.fromRGB(0,0,0)
    box.main.Thickness=1 box.main.Filled=false box.main.Color=Color3.fromRGB(255,255,255)
    box.name.Text=plr.Name box.name.Color=Color3.fromRGB(255,255,255)
    box.name.Center=true box.name.Outline=true
    boxes[plr]=box
end

local function remove_esp(plr)
    if boxes[plr] then
        boxes[plr].outline1:Remove()
        boxes[plr].outline2:Remove()
        boxes[plr].main:Remove()
        boxes[plr].name:Remove()
        boxes[plr]=nil
    end
end

local function drawCriminals()
    local active={}
    for _,m in ipairs(ws:GetChildren()) do
        if not m:IsA("Model") or not m.Parent then continue end
        if m.Name==localplayer.Name then continue end
        local lg=m:GetAttribute("LivesGiven") if lg~=1 and lg~=2 then continue end
        local root=m:FindFirstChild("HumanoidRootPart")
        if not root then continue end
        local ok,pos,vis=pcall(WorldToScreen,root.Position)
        if not ok then continue end
        if not ph[m] then
            local txt=Drawing.new("Text")
            txt.Text=m.Name.." [CRIMINAL]"
            txt.Center=true txt.Outline=true
            txt.Color=Color3.fromRGB(0,255,0)
            txt.Size=14
            ph[m]={t=txt}
        end
        ph[m].t.Visible=vis
        if vis then ph[m].t.Position=pos-Vector2.new(0,15) end
        active[m]=true
    end
    for m,e in pairs(ph) do
        if not active[m] then
            e.t:Remove()
            ph[m]=nil
        end
    end
end

local function drawSheriffs()
    local active={}
    for _,plr in ipairs(players:GetPlayers()) do
        if plr==localplayer or plr.Name==localplayer.Name then continue end
        if not Sheriff(plr) or not plr.Character then continue end
        local root=plr.Character:FindFirstChild("HumanoidRootPart")
        if not root then continue end
        local hum=plr.Character:FindFirstChild("Humanoid")
        if not hum or hum.Health<=0 then continue end
        local ok,pos,vis=pcall(WorldToScreen,root.Position)
        if not ok then continue end
        if not sh[plr] then
            local txt=Drawing.new("Text")
            txt.Text=plr.Name.." [SHERIFF]"
            txt.Center=true txt.Outline=true
            txt.Color=Color3.fromRGB(255,0,0)
            txt.Size=14
            sh[plr]={t=txt}
        end
        sh[plr].t.Visible=vis
        if vis then sh[plr].t.Position=pos-Vector2.new(0,15) end
        active[plr]=true
    end
    for plr,e in pairs(sh) do
        if not active[plr] then
            e.t:Remove()
            sh[plr]=nil
        end
    end
end

task.spawn(function()
    while true do
        drawCriminals()
        drawSheriffs()
        task.wait(0.05)
    end
end)

while true do
    local time=os.clock()
    if time-lastupdate>1 then
        for plr,_ in pairs(boxes) do remove_esp(plr) end
        for _,plr in pairs(players:GetChildren()) do
            if plr.ClassName=="Player" and plr~=localplayer and plr.Name~=localplayer.Name then
                add_esp(plr)
            end
        end
        lastupdate=time
    end
    for plr,box in pairs(boxes) do
        box.outline1.Visible=false
        box.outline2.Visible=false
        box.main.Visible=false
        box.name.Visible=false
        if plr and plr~=localplayer and plr.Name~=localplayer.Name and plr.Character then
            if Sheriff(plr) then continue end
            local hum=plr.Character:FindFirstChild("Humanoid")
            if hum and hum.Health>0 then
                local ok,x,y,w,h=getbbox(plr.Character)
                if ok then
                    box.outline1.Position=Vector2.new(x+1,y+1)
                    box.outline1.Size=Vector2.new(w-2,h-2)
                    box.outline1.Visible=true
                    box.outline2.Position=Vector2.new(x-1,y-1)
                    box.outline2.Size=Vector2.new(w+2,h+2)
                    box.outline2.Visible=true
                    box.main.Position=Vector2.new(x,y)
                    box.main.Size=Vector2.new(w,h)
                    box.main.Visible=true
                    box.name.Position=Vector2.new(x+w/2,y-16)
                    box.name.Visible=true
                end
            end
        end
    end
    task.wait(0.007)
end
